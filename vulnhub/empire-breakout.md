# Security Assessment: Empire Breakout Walkthrough

![luca-bravo-inkyAxidFX8-unsplash](https://github.com/user-attachments/assets/ccefeb30-2752-44a1-92a7-5873992a1d68)

## Introduction
Empire: Breakout is a vulnerable machine found on Vulnhub, rated as ‘Easy’. A vulnerable machine is a virtual machine that has deliberate security flaws, for the purpose of teaching ethical hacking and security testing. There are two goals for this particular machine: to get the user flag, and to escalate privileges and get the root flag. 

This post will serve as a walkthrough of the machine, detailing the steps and tools used to hack into the machine and get the two flags.

## Methodology
Tools used: nmap, wireshark, enum4linux

Nmap was used in this engagement to find the target IP address, find ports and services opened on the target, and to find the versions of those services to try to find extra vulnerabilities.

Wireshark was used to monitor traffic generated by my own scans. 

Enum4linux was used to gather information on the Samba system on the target machine. 

## Walkthrough
The first step was to get the IP address of the target machine. As a note, the IP address was visible when I actually booted up the machine, but this was just to be more ‘official’. The tool used for this was nmap, with -sn for strict host discovery.
<img width="795" height="628" alt="nmap_scan" src="https://github.com/user-attachments/assets/058bf8f3-88c6-4744-a663-c7b198575cef" />
After finding the IP address, 192.168.104.10, I once again used nmap, doing a SYN scan on the target. A SYN scan sends SYN packets to the target to look for open ports, but does not complete the TCP handshake. 
<img width="807" height="626" alt="nmap_syn_port_scan" src="https://github.com/user-attachments/assets/7ec02768-b0d3-4c00-a96d-ef0d52079c08" />
On the target machine, there was port 80 for HTTP, port 139 for netbios, port 445 for microsoft-ds, and port 10000 and 20000. Netbios facilitates communication between devices on a LAN. Microsoft-ds is used by SMB, which is used for sharing resources. 

To also see what kind of traffic I was generating, I used tcpdump and wireshark to capture packets. 
<img width="954" height="599" alt="wireshark_firstnmap" src="https://github.com/user-attachments/assets/c276b90f-4087-4f69-b70e-3b59bf0cbbde" />
Since there was a webpage, I went there to look around.
<img width="1123" height="798" alt="default_webpage" src="https://github.com/user-attachments/assets/2ff0b58f-c3fb-47f7-998d-bbe3b284b9dd" />
I found a default page, but by examining the page source, I did find something.
<img width="1087" height="241" alt="brainfuck" src="https://github.com/user-attachments/assets/414c2047-8728-4a65-8853-d415c14204b8" />
From the language in the screenshot, I figured that what was shown was some sort of password. That “encryption” is called “brainfuck”, an esoteric programming language. It is meant to be somewhat difficult to understand and implement. There are interpreters out there, though, and by using one, I was able to decrypt this password.
<img width="678" height="545" alt="interpreted_password" src="https://github.com/user-attachments/assets/1d277139-fb53-4faa-ad82-1f58db6de20d" />
Having a password, I now needed to find somewhere to use it. I decided to use nmap one more time, to figure out the versions of the services running on the target machine. Service versions often have vulnerabilities and weaknesses that can be exploited.
<img width="775" height="275" alt="nmap_sv" src="https://github.com/user-attachments/assets/c54e5edf-eed6-4678-a93e-eb1b5ddd687d" />
There were http servers running on ports 10000 and 20000. Going on port 10000 first, I found the login page. Port 20000 had the same page. 
<img width="1119" height="799" alt="login_page" src="https://github.com/user-attachments/assets/b1f19233-0cb3-4d0d-8f0c-3ad00a8453bb" />
Utilizing the enum4linux command to find any additional information, I found a username, ‘cyber’. 
<img width="785" height="558" alt="enum4linux" src="https://github.com/user-attachments/assets/9974bd41-96b6-484b-8a9f-1c4e546dd2c4" />
<img width="734" height="67" alt="username_found" src="https://github.com/user-attachments/assets/473ffa63-912e-4669-b6fd-a8020a032798" />
With that username and password, I was able to log in on the web page on port 20000.
<img width="1116" height="799" alt="logged_in" src="https://github.com/user-attachments/assets/85b5f196-7fed-4f3c-9cc5-1b5066b1fbed" />
Going to the usermin/login section, I found a command shell. I tested out a few commands and found the user flag.
<img width="1117" height="789" alt="user_flag" src="https://github.com/user-attachments/assets/3c4e7750-a533-4c15-ae69-f96ea3c5da78" />
I used this section to set up a netcat listener to connect to my Kali machine. On my Kali machine, I set up to listen on port 4444. On the screen above, I executed the command to connect to that listener. 

<img width="989" height="710" alt="setting_up_nc" src="https://github.com/user-attachments/assets/91544537-d048-4e5c-83b8-d21b27ef4c63" />

<img width="808" height="621" alt="reverse_shell" src="https://github.com/user-attachments/assets/f6149244-4f3c-4fda-a2e9-3b7d1809de72" />

Once I was in, I took a look at the tar file in the home directory. This was actually the tar binary, the archiving utility. Utilizing the getcap command, the command to examine capabilities, I found that they had CAP_DAC_READ_SEARCH. 
<img width="773" height="77" alt="tar_capabilities" src="https://github.com/user-attachments/assets/f6a8a4f7-c41a-47c1-860e-0ecbe6469282" />
This allows tar to bypass read and execute permission checks. This is a pretty serious security vulnerability, as this allows unprivileged users the ability to read files they shouldn’t be able to read.

<img width="624" height="201" alt="getting_etc_shadow" src="https://github.com/user-attachments/assets/cda81d25-b7be-49c6-8c85-b3bb449fcb0e" />

To test this out, I used this version of tar to get the /etc/shadow file. The /etc/shadow file contains hashes of all passwords for the system, and is not something that a typical user should be able to see. But utilizing this, I was able to recover it.

To exploit this, I found a file on the system, call .old_pass.bak, which contained the password for root, and utilized the tar command to open it up and switch to root. 



<img width="727" height="246" alt="exploiting" src="https://github.com/user-attachments/assets/85d2424d-036a-44d1-80a4-92fc9eadbb51" />
<img width="703" height="253" alt="iam_root" src="https://github.com/user-attachments/assets/7ce1fc2b-3b1d-4350-a2ea-a54a1603686a" />

## Findings
Password in the source code for the front page of the website.

Insufficient ‘encryption’ allowed for the password to be discovered. 

Anonymous users gaining information through enum4linux.

Outbound connections allowed a reverse shell. 

Improper capabilities on the tar binary allowed for sensitive files and privilege escalation. 

## Remediations
Remove any sensitive information from publicly viewable places, no matter how ‘encrypted’ they may be. 

Utilize an actual encryption algorithm for sensitive information.

Configure Samba to prevent anonymous users from getting information that shouldn’t go out.

Use a firewall to prevent/limit outbound connections for any reverse shells. 

Set the capabilities for any binaries like tar so that they can’t be used to read sensitive information. 



